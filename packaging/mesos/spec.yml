---
name: mesos
version: 0.23.0
license: ASL 2.0
iteration: 1
vendor: Mesos
architecture: x86_64
url: http://mesos.apache.org/
description: Apache Mesos abstracts CPU, memory, storage, and other compute resources away from machines (physical or virtual), enabling fault-tolerant and elastic distributed systems to easily be built and run effectively.

depends:
  - cyrus-sasl
  - cyrus-sasl-md5

resources:
  - url: http://archive.apache.org/dist/mesos/{{.Version}}/mesos-{{.Version}}.tar.gz
    hash-type: sha1
    hash: 05006a8a2752a089f40823d1c9ec795476ed0b93

targets:
  - src: "{{.BuildRoot}}/out/"
    dest: /

scripts:
  build: |
    set -ex
    tar -xzf mesos-{{.Version}}.tar.gz

    ## build mesos
    cd mesos-{{.Version}}
    mkdir build
    pushd build
    ../configure --prefix=/usr --enable-optimize
    make -j {{.CPUs}}
    popd

    ## create an installation
    INSTALL={{.BuildRoot}}/out
    mkdir $INSTALL
    ( cd build/ && make install DESTDIR="$INSTALL" )

    pushd $INSTALL
    mkdir -p var/log/mesos var/lib/mesos

    # jars
    mkdir -p usr/share/java
    cp {{.BuildRoot}}/mesos-{{.Version}}/build/src/java/target/mesos-*.jar usr/share/java

    # symlinks
    mkdir -p usr/local/lib
    # ensure symlinks are relative so they work as expected in the final env
    ( cd usr/local/lib && cp -s ../../lib/lib*so . )

  before-install: |
    # create some directories which conflict with other packages if specified as
    # being managed by the package
    for dir in /usr/share/java /usr/lib/python2.7/site-packages; do
      mkdir -p $dir || true
    done

  after-install: |
    ldconfig

extra-args: |
  --rpm-os linux
  --rpm-auto-add-exclude-directories /usr/share/java
  --rpm-auto-add-exclude-directories /usr/lib/python2.7
  --rpm-auto-add-exclude-directories /usr/lib/python2.7/site-packages